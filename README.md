# IBM-Cloud-Vulnerability-Advisor-

## en construcción :hammer:
Objetivos
Los objetivos del tutorial son:

Comprender las características principales de IBM Cloud Container Registry and Vulnerability Advisor
Utilice las funciones de estos servicios para crear un flujo de trabajo
Servicios utilizados
Este tutorial utiliza los siguientes servicios de IBM Cloud:

Registro de contenedores de IBM Cloud
Servicio IBM Cloud Kubernetes
### Requisitos

Antes de comenzar, complete las siguientes tareas:

1.Instalar Git.

2.Instalar Cloud de IBM Developer Tools , una secuencia de comandos para instalar docker, kubectl, helm, ibmcloud CLI y requiere plug-ins.

3.Crea un clúster.

4.Asegúrese de tener los permisos de acceso correctos para agregar y eliminar espacios de nombres, consulte Roles de acceso para configurar IBM Cloud Container Registry .

### Paso 1: Del código a un contenedor en ejecución

El uso de IBM Cloud Container Registry para almacenar las imágenes de su contenedor es la forma más sencilla de poner en marcha una aplicación con IBM Cloud Kubernetes Service. En esta sección, crea una imagen de contenedor, la almacena en IBM Cloud Container Registry y crea un despliegue de Kubernetes que utiliza esa imagen.

1. Cree un namespaces (recomendación)
2. Cree un namespaces para almacenar sus imágenes de contenedor en IBM Cloud Container Registry. (recomendación)
3. Para iniciar sesión en IBM Cloud y apuntar a la us-southregión, ejecute el siguiente comando:

```
ibmcloud login -r us-south [--sso]
```

4. Si tiene una identificación federada, úsela ibmcloud login -r us-south --sso para iniciar sesión. 
5. Ingrese su nombre de usuario y use la URL proporcionada en su salida CLI para recuperar su código de acceso único. Si tiene un ID federado, el inicio de sesión falla sin el --sso.

6. Establecer us-southcomo región de destino para los mandatos de IBM Cloud Container Registry:
```
ibmcloud cr region-set us-south
```

7. Cree un namespaces ejecutando el siguiente comando. Elija un nombre para su namespace y reemplácelo <my_namespace> con ese nombre:
```
ibmcloud cr namespace-add <my_namespace>
```
Nota: Si desea crear el namespace en un grupo de recursos específico, consulte Configurar un namespace.

**_A lo largo de este tutorial, reemplace <my_namespace>con su namespace elegido._**

Nota: El namespace debe ser exclusivo en todas las cuentas de IBM Cloud en la misma región. Los namespace deben tener de 4 a 30 caracteres e incluir solo letras minúsculas, números, guiones (-) y guiones bajos (_). Los namespaces deben comenzar y terminar con una letra o un número.

### Cree y envíe una imagen

Para crear una imagen de contenedor y enviarla a IBM Cloud Container Registry , necesita una aplicación y un Dockerfile. Para obtener la aplicación y el Dockerfile, y los otros artefactos que necesita, clone el repositorio de GitHub asociado con este tutorial. Para el resto de este tutorial, asegúrese de ejecutar todos los comandos desde el directorio del repositorio clonado.

1. Para construir la imagen, ejecute el siguiente comando:

```
docker build -t us.icr.io/<my_namespace>/hello-world:1 .
```
Docker debe estar ejecutándose en su computadora o los dockercomandos fallarán.

2.Registre su daemon de Docker local en IBM Cloud Container Registry ejecutando el siguiente comando:

```
ibmcloud cr login
```
A continuación se muestran los pasos anteriores
![image](https://github.com/emeloibmco/IBM-Cloud-Vulnerability-Advisor/blob/main/Advisor/1advisor.gif)

3. Empuje la imagen ejecutando el siguiente comando:
```
docker push us.icr.io/<my_namespace>/hello-world:1
```

4. Confirma que tu imagen se cargó correctamente ejecutando el siguiente comando:

```
ibmcloud cr images
```

Nota: Puede automatizar el acceso a IBM Cloud Container Registry con claves de API y otorgar acceso a los recursos de IBM Cloud Container Registry utilizando IAM.


![image](https://github.com/emeloibmco/IBM-Cloud-Vulnerability-Advisor/blob/main/Advisor/2advisor.gif)


### Implemente un contenedor que use su imagen

Ahora que tiene una imagen almacenada en IBM Cloud Container Registry, puede ejecutar un contenedor en IBM Cloud Kubernetes Service que utiliza esa imagen, consulte Despliegue de aplicaciones con la CLI .

**A lo largo de este tutorial, reemplace <my_cluster>con el nombre de su clúster de Kubernetes gratuito.**

1. Ejecute el siguiente comando:
```
ibmcloud ks cluster-config <my_cluster> --export
```
Este comando produce un exportcomando que establece la KUBECONFIGvariable de entorno.

2. Ejecute el exportcomando, que fue generado por el comando anterior, copiándolo y pegándolo.

3. Actualice la siguiente línea en el hello-world.yaml archivo reemplazándola <my_namespace>con su espacio de nombres:

```
image: us.icr.io/<my_namespace>/hello-world:1
```
4. Ejecute su imagen como una implementación y expóngala creando un servicio al que se accede a través de la dirección IP del nodo trabajador:

```
kubectl apply -f hello-world.yaml
```
5. Busque el puerto que se utiliza en el nodo trabajador examinando su nuevo servicio ejecutando el siguiente comando:
```
kubectl describe service hello-world
```
6. Anote el número en la NodePort:línea6. A lo largo de este tutorial, use el número para reemplazar la variable <node_port>.

7. En el resultado del siguiente comando, anote la dirección IP pública. A lo largo de este tutorial, reemplace la variable <public_ip>con la dirección IP:

```
ibmcloud ks workers <my_cluster>
```
7. Acceda a su servicio ejecutando el siguiente comando. También puede utilizar un navegador web.

```
curl <public_ip>:<node_port>
```
Si ves "¡Hola, mundo!", Estás listo.

### Paso 2: proteja sus imágenes y clústeres

Cuando inserta una imagen en un espacio de nombres, el Asesor de vulnerabilidades la analiza automáticamente para encontrar posibles vulnerabilidades . Si se encuentran vulnerabilidades, se proporcionan instrucciones para ayudar a corregir las vulnerabilidades informadas.

Para demostrar estas características, debe enviar una imagen intencionalmente vulnerable.

Las imágenes se actualizan continuamente y se descubren nuevos CVE. Como resultado, es posible que vea más vulnerabilidades presentes en su imagen. Si es así, corrija esas vulnerabilidades utilizando la información proporcionada por Vulnerability Advisor.

Ver el informe de vulnerabilidad de su imagen
Cuando se encuentra una vulnerabilidad en una de sus imágenes, se genera un informe que le brinda más información sobre la vulnerabilidad y los pasos para resolverla.

Construye e impulsa una imagen vulnerable:

Cree una imagen vulnerable ejecutando el siguiente comando:

```
docker build -t us.icr.io/<my_namespace>/hello-world:2 -f Dockerfile-vulnerable .
```
Empuje la imagen vulnerable ejecutando el siguiente comando:

```
docker push us.icr.io/<my_namespace>/hello-world:2
```
Puede leer el Dockerfile para comprender mejor cómo se hizo vulnerable esta imagen. En resumen, se usa una imagen base de Debian y el aptpaquete se revierte a una versión que es vulnerable a CVE-2019-3462.

Enumere sus imágenes y tome nota de la SECURITY STATUScolumna ejecutando el siguiente comando:

```
ibmcloud cr images
```
Esta columna transmite la cantidad de problemas presentes en su imagen. Debido a que el número no es cero, esta imagen es vulnerable.

Ejecute el comando ibmcloud cr vulnerability-assessment(alias ibmcloud cr va) para obtener más información sobre la vulnerabilidad:

```
ibmcloud cr va us.icr.io/<my_namespace>/hello-world:1
```
Entre otras cosas, esta salida incluye el ID de la vulnerabilidad (si corresponde), el paquete afectado y los pasos para resolver el problema.

